%----------------------------------------------------------------------------------------
%	PACKETS AND CONFIGURATION
%----------------------------------------------------------------------------------------

\documentclass[12pt, a4paper]{article}

\usepackage{times} % Times New Roman font
\usepackage{graphicx} % 'graphics' package interface
\usepackage{geometry} % Edit document margins
\usepackage{hyperref} % Table of contents hyperlinks
\usepackage{tcolorbox} % Colored boxes for code
\usepackage[font=small, labelfont=bf]{caption} % Image caption font
\usepackage{longtable} % Build long tables
\usepackage{xurl} % URL breaking

% HELPER PACKAGES (REMOVE IN FINAL) %
\usepackage{blindtext} % Lorem Ipsum
\usepackage{todonotes} % TODOs as useful reminders
\setlength{\marginparwidth}{2cm} % Otherwise todonotes gets angry at me lol
\setuptodonotes{fancyline, color=green!40, shadow} % TODOs options
% HELPER PACKAGES (REMOVE IN FINAL) %

\graphicspath{ {./res/} } % Path to graphics
\hypersetup{    % ToC Hyperlink setup
    colorlinks,
    citecolor=blue,
    filecolor=blue,
    linkcolor=blue,
    urlcolor=blue
}

% Add subsubsubsection
\makeatletter
\newcommand\subsubsubsection{\@startsection{paragraph}{4}{\z@} %
                            {-2.5ex\@plus -1ex \@minus -.25ex} %
                            {1.25ex \@plus .25ex} %
                            {\normalfont\normalsize\bfseries}}
\makeatother
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}

%----------------------------------------------------------------------------------------
%	DOCUMENT
%----------------------------------------------------------------------------------------

\begin{document}

\newgeometry{top=7cm, bottom=2cm} % Setting the margins for the title

% Title
\begin{titlepage}
    \centering
    {\Huge\bfseries Pandemic Information System Model\par} % Project title
    \vspace{1.5cm}
    {\scshape\large Systems and Methods for Big and Unstructured Data \par} % Course
    \vspace{0.5cm}
    {\scshape\large Prof. Marco Brambilla \par} % Professor
    \vspace{1cm}
    {\scshape\large % Description
        Third delivery \par 
        Elasticsearch Project \par 
    }
    \vspace{0.5cm}
    {\slshape\large January 2022 \par} % Date
    \vspace{1cm}
    \linespread{0.8} % Authors interline
    {\large\itshape % Authors
        Avci Oguzhan - \texttt{10557284}\\
        Gentile Nicole - \texttt{10594355}\\
        Rigamonti Davide - \texttt{10629791}\\
        Singh Raul - \texttt{10623232}\\
        Tagliaferri Mattia - \texttt{10572418}
    }
    \vfill
    \begin{figure}[b]
        \includegraphics[scale=0.6]{polimi.png} % Polimi logo
        \centering
    \end{figure}

    \pagenumbering{gobble} % Remove page number

\end{titlepage}

\newgeometry{bottom=3cm} % Reset the margins
\pagenumbering{arabic} % Reset the page number

\clearpage

% INDEX
{
    \hypersetup{hidelinks}
    \tableofcontents
}

% LIST OF TODOs (REMOVE IN FINAL)
\listoftodos

\clearpage

% INTRODUCTION
\section{Introduction}

\subsection{Problem Specification}

The idea of the project is to use Elasticsearch to store and analyze data about 
COVID-19 vaccinations in Italy. The data we used can be found in the following 
GitHub repository: \url{https://raw.githubusercontent.com/italia/covid19-opendata-vaccini/master/dati/somministrazioni-vaccini-latest.csv}
and contains data about daily vaccinations divided by region and age range. \\ 
The main goal is to analyze the data in order to build meaningful statistics 
about the vaccinations in Italy; examples can be the total number of doses for each 
vaccine brand, the top regions for vaccine administration etc.

\subsection{Hypoteses}

\begin{itemize}
    \item[] We assumed that the general user doesn't know the italian language, therefore
        all the fields' names contained in the dataset were renamed to an appropriate 
        english translation 
\end{itemize}
  
\clearpage

% DATABASE
\section{Data }

\subsection{Schema description}

\todo{add field descriptions}
\begin{itemize}
    \item Schema for \textbf{vaccines administrations} 
        (somministrazioni-vaccini-latest.csv):
        \begin{itemize}
            \item administration\_date (data\_somministrazione): \emph{date [iso8601]} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item supplier (fornitore): \emph{keyword} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item male\_gender (sesso\_maschile): \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item female\_gender (sesso\_femminile): \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item first\_dose (prima\_dose): \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item second\_dose (seconda\_dose): \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item previous\_infection (pregressa\_infezione): \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item booster\_dose (dose\_addizionale\_booster): \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item total\_doses: \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item NUTS1\_code (codice\_NUTS1): \emph{keyword} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item NUTS2\_code (codice\_NUTS2): \emph{keyword} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item ISTAT\_region\_code (codice\_regione\_ISTAT): \emph{keyword} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item area\_name (nome\_area): \emph{text} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
        \end{itemize}
    \item Schema for \textbf{population} (platea.csv):
        \begin{itemize}
            \item area (area): \emph{keyword} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item area\_name (nome\_area): \emph{text} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item age\_range (fascia\_anagrafica): \emph{keyword} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
            \item total\_population (totale\_popolazione): \emph{long} \\
                \begin{footnotesize}
                    ---
                \end{footnotesize}
        \end{itemize}
    \item Schema for \textbf{healed} (soggetti-guariti.csv):
    \begin{itemize}
        \item area (area): \emph{keyword} \\
            \begin{footnotesize}
                ---
            \end{footnotesize}
        \item area\_name (nome\_area): \emph{text} \\
            \begin{footnotesize}
                ---
            \end{footnotesize}
        \item age\_range (fascia\_anagrafica): \emph{keyword} \\
            \begin{footnotesize}
                ---
            \end{footnotesize}
        \item total\_healed (totale\_healed): \emph{long} \\
            \begin{footnotesize}
                ---
            \end{footnotesize}
    \end{itemize}
\end{itemize}

\subsection{Dataset description}

The dataset contains data about COVID-19 vaccinations in Italy. \\
For each day, region and age range we have information about the number of vaccinated 
people (male and female), the number of 1st, 2nd and booster doses and information 
about the number of people who was previously infected. \\
We decided to integrate this data using the ‘platea.csv’ dataset that can be found 
in the specified repository; it contains data about the population for each region 
and each age range. \\ 
We also used information about the number of healed people in each region that can be 
found in ‘soggetti-guariti.csv’ present in the same repository.

%QUERIES
\subsection{Queries} \todo{manca la descrizione}
\subsubsection{Number of daily vaccines for each dose (1st, 2nd or booster)}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{
"size": 0, 
  "aggs": {
    "Region": {
      "terms": {
        "field": "administration_date"
      },
      "aggs": {
        "totalFirstDoses": {
          "sum": {
            "field": "first_dose"
          }
        },        
        "totalSecondDoses": {
          "sum": {
            "field": "second_dose"
          }
        },        
        "totalBoosters": {
          "sum": {
            "field": "booster_dose"
          }
        }
      }
    }
  } 
}

    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of vaccines by gender in each region}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{
"size": 0, 
  "aggs": {
    "Region": {
      "terms": {
        "field": "area",
        "size": 21
      },
      "aggs": {
        "totalWomenDoses": {
          "sum": {
            "field": "female_gender"
          }
        },        
        "totalMenDoses": {
          "sum": {
            "field": "male_gender"
          }
        }
      }
    }
  } 
}

    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of vaccines in each region (divided in 1,2, booster and total vaccinations)}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{
"size": 0, 
  "aggs": {
    "Region": {
      "terms": {
        "field": "area",
        "size": 21
      },
      "aggs": {
        "totalFirstDoses": {
          "sum": {
            "field": "first_dose"
          }
        },        
        "totalSecondDoses": {
          "sum": {
            "field": "second_dose"
          }
        },        
        "totalBoosters": {
          "sum": {
            "field": "booster_dose"
          }
        },        
        "totalDoses": {
          "sum": {
            "field": "total_doses"
          }
        }
      }
    }
  } 
}

    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of doses for each vaccine supplier}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{"size":0,
  "aggs": {
    "supplier": {
      "terms": {
        "field": "supplier"
      },
      "aggs": {
        "total_doses" : { "sum" : {
          "field": "total_doses"
          }
        }
      }
    }
  }
}

    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of doses divided by NUTS1}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{"size":0,
  "aggs": {
    "by_NUTS1": {
      "terms": {
        "field": "NUTS1_code"
      },
      "aggs": {
        "total_doses" : { "sum" : {
          "field": "total_doses"
          }
        }
      }
    }
  }
}
    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of people with previous infection by region}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{
  "size":0,
  "aggs": {
    "Region": {
      "terms": {
        "field": "area"
      },
      "aggs": {
        "People with previous infection": {
          "sum": {
            "field": "previous_infection"
          }
        }
      }
    }
  }
}
    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of vaccines by age range}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{"size":0,
  "aggs": {
    "by_age": {
      "terms": {
        "field": "age_range"
      },
      "aggs": {
        "total_doses" : { "sum" : { 
          "field": "total_doses"
          }
        }
      }
    }
  }
}

    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of average doses per region}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{"size":0,
  "aggs": {
    "Region": {
      "terms": {
        "field": "area"
      },
      "aggs": {
        "avg_doses" : { "avg": {
          "field": "total_doses"
        } } 
      }
    }
  }
}

    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of vaccinations for age group and vaccine supplier}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{
  "size": 0,
  "track_total_hits": true,
  "aggs": {
    "age_groups_types": {
      "composite": {
        "sources": [{
          "fascia_anagrafica": {
            "terms": { 
              "field": "age_range"
            }
          }
        }, {
          "supplier": {
            "terms": { 
              "field": "supplier"
            }
          }
        }], 
        "size": 10000
      },
      "aggs": {
        "total_vaccines": {
          "sum": {
            "field": "total_doses"
          }
        }
      }
    }
  }
}
    \end{verbatim}
\end{tcolorbox}

\subsubsection{Number of booster doses for age group}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET /index-vaccines_administrations/_search
{
  "size": 0,
  "aggs": {
    "age_groups": {
      "terms": { 
        "field": "age_range" 
      },
      "aggs": {
        "boosters_per_group": {
          "sum": {
            "field": "booster_dose"
          }
        }
      }
    }
  }
}
    \end{verbatim}
\end{tcolorbox}

\subsubsection{Top 10 dates with most vaccinations}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
GET index-vaccines_administrations/_search
{
  "size": 0,
  "aggs": {
    "dates": {
      "terms": { 
        "field": "administration_date" 
      },
      "aggs": {
        "sum_vaccinations": {
          "sum": {
            "field": "total_doses"
          }
        },
        "dates_sort": {
          "bucket_sort": {
            "sort": [
              { "sum_vaccinations": { "order" : "desc" } }
            ],
            "size": 10
          }
        }
      }
    }
  }
}
    \end{verbatim}
\end{tcolorbox}

\todo{add queries}

\subsubsection{Number of daily vaccines for each dose}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of doses per gender in each region}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of doses in each region}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of doses for each brand}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of doses for each NUTS1 zone}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of doses for each age group}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsubsection{Grouping by age range and region}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of average doses per region}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of doses for age group and brand}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Number of booster doses for age group}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Top 10 dates with most vaccinations}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsection{Commands}

\todo{add commands}

\subsubsection{Add entries for a given day}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\subsubsection{Remove entries from a given day}

\begin{tcolorbox}[fontupper=\scriptsize]
    \begin{verbatim}
    \end{verbatim}
\end{tcolorbox}

\noindent
\blindtext

\clearpage

\section{Data Visualization with Kibana}

\blindtext

\subsection{Screenshots}

\blindtext

\clearpage

%OPTIONAL POINT N°2
\section{Other features in ---} \todo{NOSQL Platform}

\blindtext

\clearpage

% REFERENCES AND SOURCES
\section{References and sources}

In order to develop these project, the following tools were used:

\begin{itemize}
    \item Elasticsearch and Kibana in order to store, query and visualize data;
    \item \LaTeX~to write the report;
    \item Github as a versioning and collaboration mean;
    \item \url{https://github.com/italia/covid19-opendata-vaccini} \\
        as a source of updated and real data about vaccinations in Italy.
\end{itemize}

\clearpage

\end{document}